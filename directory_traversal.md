# Directory traversal

ในส่วนนี้เราจะอธิบายว่า `Diractory traversal` คืออะไรอธิบายวิธีดำเนินการโจมตีข้ามเส้นทางและหลีกเลี่ยงอุปสรรคทั่วไปและระบุวิธีป้องกันช่องโหว่ traversal นี้

![](https://portswigger.net/web-security/images/directory-traversal.svg)

## What is directory traversal?

`Directory traversal` (หรือที่เรียกว่า file path traversal) เป็นช่องโหว่ด้านความปลอดภัยของเว็บที่อนุญาตให้ผู้โจมตีอ่านไฟล์โดยพลการบนเซิร์ฟเวอร์ที่กำลังเรียกใช้แอปพลิเคชัน ซึ่งอาจรวมถึงรหัสแอปพลิเคชันและข้อมูลหนังสือรับรองสำหรับระบบส่วนหลังและไฟล์ระบบปฏิบัติการที่ละเอียดอ่อน ในบางกรณีผู้โจมตีอาจสามารถเขียนไปยังไฟล์ที่กำหนดเองบนเซิร์ฟเวอร์ทำให้สามารถแก้ไขข้อมูลหรือพฤติกรรมของแอปพลิเคชันและในที่สุดก็สามารถควบคุมเซิร์ฟเวอร์ได้อย่างเต็มที่

### การอ่านไฟล์โดยพลการผ่าน Directory traversal

พิจารณาแอปพลิเคชันการช็อปปิ้งที่แสดงรูปภาพของสินค้าสำหรับขาย รูปภาพถูกโหลดผ่าน HTML ดังต่อไปนี้:

```html
<img src="/loadImage?filename=218.png">
```
loadImage URL รับพารามิเตอร์ filename และส่งคืนเนื้อหาของไฟล์ที่ระบุ ไฟล์ภาพจะถูกเก็บไว้ในดิสก์ในตำแหน่ง /var/www/images/ ในการส่งคืนรูปภาพแอปพลิเคชันจะต่อท้ายชื่อไฟล์ที่ร้องขอเข้ากับไดเร็กทอรีฐานนี้และใช้ระบบไฟล์ API เพื่ออ่านเนื้อหาของไฟล์ ในกรณีข้างต้นแอปพลิเคชันอ่านจากพาธไฟล์ต่อไปนี้:

```html
/var/www/images/218.png
```
แอปพลิเคชันไม่มีการป้องกันจากการโจมตีแบบข้ามผ่านไดเรกทอรีดังนั้นผู้โจมตีสามารถขอ URL ต่อไปนี้เพื่อดึงไฟล์โดยพลการจากระบบไฟล์ของเซิร์ฟเวอร์: 

```
https://insecure-website.com/loadImage?filename=../../../etc/passwd
```

สิ่งนี้ทำให้แอปพลิเคชันอ่านจากพาธไฟล์ต่อไปนี้:

```
/var/www/images/../../../etc/passwd
```
ลำดับ ../ ถูกต้องภายในเส้นทางไฟล์และหมายถึงการก้าวขึ้นหนึ่งระดับในโครงสร้างไดเร็กทอรี ลำดับ .. / สามลำดับต่อเนื่องกันเพิ่มขึ้นจาก /var/www/images/ ไปยังรูทของระบบไฟล์ดังนั้นไฟล์ที่อ่านจริงคือ:

```
/etc/passwd
```
บนระบบปฏิบัติการที่ใช้ Unix นี่คือไฟล์มาตรฐานที่มีรายละเอียดของผู้ใช้ที่ลงทะเบียนบนเซิร์ฟเวอร์
ใน Windows ทั้ง ../ และ .. \ เป็นลำดับการส่งผ่านไดเร็กทอรีที่ถูกต้องและการโจมตีที่เทียบเท่ากันเพื่อดึงไฟล์ระบบปฏิบัติการมาตรฐานคือ:

```html
https://insecure-website.com/loadImage?filename=..\..\..\windows\win.ini
```





