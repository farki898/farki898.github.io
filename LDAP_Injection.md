# LDAP Injection

![](https://dpsvdv74uwwos.cloudfront.net/statics/img/blogposts/ldap-injection.png)

การโจมตีด้วย `LDAP Injection` ใช้ช่องโหว่ในการตรวจสอบความถูกต้องของอินพุตเพื่อ Inject และดำเนินการสืบค้นไปยังเซิร์ฟเวอร์ Lightweight Directory Access Protocol บริการ LDAP มีความสำคัญต่อการดำเนินงานประจำวันของหลายองค์กรและการโจมตีด้วย LDAP Injection ที่ประสบความสำเร็จสามารถให้ข้อมูลที่มีค่าสำหรับการโจมตีฐานข้อมูลและแอปพลิเคชันภายในเพิ่มเติม บทความนี้กล่าวถึงวิธีการทำงานของ LDAP Injection และแสดงวิธีป้องกันเพื่อปรับปรุงความปลอดภัยของเว็บแอปพลิเคชัน

## ความสำคัญของเซิร์ฟเวอร์ LDAP

Lightweight Directory Access Protocol หรือ LDAP เป็นโปรโตคอลแอปพลิเคชันแบบเปิดสำหรับการเข้าถึงและบำรุงรักษาบริการไดเร็กทอรีในเครือข่าย IP (ดูข้อกำหนด RFC 4511) โดยทั่วไปองค์กรจะจัดเก็บข้อมูลเกี่ยวกับผู้ใช้และทรัพยากรในไดเร็กทอรีกลาง (เช่น Active Directory) และแอปพลิเคชันสามารถเข้าถึงและจัดการข้อมูลนี้โดยใช้คำสั่ง LDAP เซิร์ฟเวอร์ LDAP เป็นประตูสู่ข้อมูลที่ละเอียดอ่อนมากมายรวมถึงข้อมูลรับรองผู้ใช้ชื่อพนักงานและบทบาทอุปกรณ์ทรัพยากรเครือข่ายที่ใช้ร่วมกันเป็นต้น แม้ว่าจะมีการเผยแพร่สู่สาธารณะน้อยกว่าการโจมตีด้วยการฉีด SQL แต่การโจมตีด้วยการฉีด LDAP สามารถให้ข้อมูลที่มีค่าเกี่ยวกับโครงสร้างพื้นฐานภายในขององค์กรและอาจทำให้ผู้โจมตีสามารถเข้าถึงเซิร์ฟเวอร์ฐานข้อมูลและระบบภายในอื่น ๆ ได้

## LDAP Statement Syntax

ไคลเอ็นต์สามารถสอบถามเซิร์ฟเวอร์ LDAP ได้โดยการส่งคำร้องขอรายการไดเร็กทอรีที่ตรงกับตัวกรองเฉพาะ หากพบรายการที่ตรงกับตัวกรองการค้นหา LDAP เซิร์ฟเวอร์จะส่งคืนข้อมูลที่ร้องขอ ตัวกรองการค้นหาที่ใช้ในการสืบค้น LDAP เป็นไปตามไวยากรณ์ที่ระบุใน RFC 4515 (เดิมคือ RFC 2254) ตัวกรองสร้างจากแอตทริบิวต์ LDAP จำนวนเท่าใดก็ได้ที่ระบุเป็นคู่คีย์ - ค่าในวงเล็บ ตัวกรองสามารถรวมกันได้โดยใช้ตัวดำเนินการเชิงตรรกะและตัวดำเนินการเปรียบเทียบและสามารถรวมสัญลักษณ์แทนได้ นี่คือตัวอย่างบางส่วน:

- (cn = John *) จับคู่รายการที่ชื่อสามัญขึ้นต้นด้วย John (* ตรงกับอักขระใด ๆ )
- (! (cn = * Doe)) จับคู่รายการที่ชื่อสามัญไม่ได้ลงท้ายด้วย Doe (! is logical NOT)
- (& (cn = J *) (cn = * Doe)) จับคู่รายการที่ชื่อสามัญขึ้นต้นด้วย J และลงท้ายด้วย Doe (& เป็นตรรกะ AND)
- (& (| (cn = John *) (cn = Jane *)) (cn = * Doe)) จับคู่รายการที่ชื่อสามัญขึ้นต้นด้วย John หรือ Jane และลงท้ายด้วย Doe (| เป็นตรรกะหรือ)
ตัวกรองและตัวดำเนินการหลายตัวถูกรวมเข้าด้วยกันโดยใช้สัญกรณ์นำหน้า (สัญกรณ์ภาษาโปแลนด์) โดยมีอาร์กิวเมนต์ตามหลังตัวดำเนินการ สำหรับคำอธิบายทั้งหมดของไวยากรณ์ตัวกรองการค้นหา LDAP โปรดดู [RFC 4515](https://tools.ietf.org/html/rfc4515).
                                                                                                                                                                                                                                                                      
